- name: Install PipeWire audio stack
  apt:
    name:
      - pipewire
      - pipewire-audio
      - pipewire-pulse
      - pipewire-alsa
      - wireplumber
      - pavucontrol
    state: present
  become: true

- name: Ensure user is in audio and video groups
  user:
    name: "{{ ansible_user_id }}"
    groups: audio,video
    append: true
  become: true

- name: Enable PipeWire services
  systemd:
    name: "{{ item }}"
    enabled: true
    state: started
    scope: user
  loop:
    - pipewire.socket
    - wireplumber.service
    - pipewire-pulse.socket
  fail_when: false
