- name: Install base packages
  apt:
    name:
      - git
      - zsh
      - stow
      - curl
      - wget
      - nala
      - g++
      - build-essential
      - zip
      - unzip
      - jq
      - ca-certificates
      - gnupg
      - apt-transport-https
      - software-properties-common
    state: present
    update_cache: true
  become: true

- name: Install system utilities
  apt:
    name:
      - tlp
      - tlp-rdw
      - keyd
      - playerctl
      - brightnessctl
    state: present
  become: true

- name: Set zsh as default shell
  user:
    name: "{{ ansible_user_id }}"
    shell: /usr/bin/zsh
  become: true

- name: Ensure ~/.local/bin directory exists
  file:
    path: "{{ bin_dir }}"
    state: directory
    mode: "0755"

- name: Enable TLP service
  systemd:
    name: tlp
    enabled: true
    state: started
  become: true

- name: Deploy keyd configuration
  copy:
    content: |
      [ids]
      *
      [main]
      capslock = esc
      esc = capslock
    dest: /etc/keyd/default.conf
    mode: "0644"
  become: true
  notify: restart keyd

- name: Configure firewall
  import_tasks: ufw.yml
